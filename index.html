<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geo IP Lookup</title>
    <link rel="icon" href="https://www.cosmos.so/favicon.ico" />
    <style>
      :root {
        color-scheme: dark;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #000;
        font-family: "Inter", "Segoe UI", Arial, sans-serif;
      }

      #content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        width: min(90vw, 22rem);
        text-align: center;
      }

      #flag {
        font-size: clamp(5rem, 45vw, 10rem);
        line-height: 1;
      }

      #ip {
        font-size: clamp(1.75rem, 10vw, 2.75rem);
        font-weight: 600;
        color: #fff;
        letter-spacing: 0.05em;
        word-break: break-word;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <span id="flag">ðŸ¥·</span>
      <span id="ip"></span>
    </div>
    <script>
      const flagElement = document.getElementById("flag");
      const ipElement = document.getElementById("ip");

      function countryCodeToFlag(code) {
        if (!code || code.length !== 2) {
          return "ðŸ¥·";
        }

        const base = 0x1f1e6;
        const upper = code.toUpperCase();
        const first = upper.codePointAt(0);
        const second = upper.codePointAt(1);

        if (!first || !second) {
          return "ðŸ¥·";
        }

        return String.fromCodePoint(base + first - 65, base + second - 65);
      }

      async function fetchCountryCode() {
        try {
          const response = await fetch("https://api.cosmos.so/graphql", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: `query GetCountryCode {\n  countryCode {\n    countryCode\n    ipAddress\n  }\n}`,
            }),
          });

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const payload = await response.json();
          const countryInfo = payload?.data?.countryCode;

          const flag = countryCodeToFlag(countryInfo?.countryCode);
          flagElement.textContent = flag;
          ipElement.textContent = countryInfo?.ipAddress ?? "";
        } catch (error) {
          flagElement.textContent = "ðŸ¥·";
          ipElement.textContent = "";
        }
      }

      fetchCountryCode();
    </script>
  </body>
</html>
